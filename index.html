<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GitHubè¯­éŸ³è¾“å…¥æµ‹è¯•</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
    body { padding: 20px; max-width: 600px; margin: 0 auto; }
    h1 { text-align: center; margin-bottom: 30px; color: #2d3748; }
    .btn-group { display: flex; gap: 15px; justify-content: center; margin-bottom: 30px; }
    button { padding: 12px 24px; font-size: 18px; border: none; border-radius: 8px; cursor: pointer; }
    #startBtn { background: #48bb78; color: white; }
    #stopBtn { background: #f56565; color: white; opacity: 0.5; cursor: not-allowed; }
    #result { padding: 20px; border: 2px solid #e2e8f0; border-radius: 8px; min-height: 100px; font-size: 16px; line-height: 1.6; color: #4a5568; }
    .tip { text-align: center; margin-top: 10px; font-size: 14px; color: #718096; }
  </style>
</head>
<body>
  <h1>è¯­éŸ³è¾“å…¥æµ‹è¯•</h1>
  
  <div class="btn-group">
    <button id="startBtn">å¼€å§‹è†å¬</button>
    <button id="stopBtn" disabled>åœæ­¢è†å¬</button>
  </div>

  <div id="result">ç‚¹å‡»ã€Œå¼€å§‹è†å¬ã€ï¼Œè¯´å‡ºå†…å®¹åå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
  <p class="tip">æç¤ºï¼šè¯·ä½¿ç”¨Chrome/Edgeæµè§ˆå™¨ï¼Œç¡®ä¿éº¦å…‹é£æƒé™å·²å¼€å¯</p>

  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const resultEl = document.getElementById('result');
    let recognition = null;
    let isListening = false;

    // åˆå§‹åŒ–è¯­éŸ³è¯†åˆ«
    function initRecognition() {
      // æ£€æµ‹æµè§ˆå™¨æ”¯æŒ
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        resultEl.textContent = 'âŒ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³è¯†åˆ«ï¼Œè¯·ä½¿ç”¨æœ€æ–°ç‰ˆChromeæˆ–Edge';
        startBtn.disabled = true;
        startBtn.style.opacity = 0.5;
        return null;
      }

      // åˆ›å»ºè¯†åˆ«å®ä¾‹
      recognition = new SpeechRecognition();
      recognition.lang = 'zh-CN'; // ä¸­æ–‡è¯†åˆ«
      recognition.interimResults = true; // å®æ—¶æ˜¾ç¤ºä¸­é—´ç»“æœ
      recognition.continuous = true; // æŒç»­è†å¬

      // è¯†åˆ«ç»“æœå›è°ƒï¼ˆæ ¸å¿ƒï¼‰
      recognition.onresult = (event) => {
        let transcript = '';
        // æ‹¼æ¥æ‰€æœ‰è¯†åˆ«ç»“æœ
        for (let i = event.resultIndex; i < event.results.length; i++) {
          transcript += event.results[i][0].transcript;
        }
        resultEl.textContent = `ğŸ¤ ä½ è¯´çš„ï¼š${transcript}`;
      };

      // è¯†åˆ«é”™è¯¯å›è°ƒ
      recognition.onerror = (error) => {
        const errorMsg = {
          'not-allowed': 'âŒ éº¦å…‹é£æƒé™è¢«æ‹’ç»ï¼Œè¯·åœ¨æµè§ˆå™¨è®¾ç½®ä¸­å¼€å¯',
          'no-speech': 'ğŸ”‡ æœªæ£€æµ‹åˆ°å£°éŸ³ï¼Œè¯·é è¿‘éº¦å…‹é£å¤§å£°è¯´è¯',
          'network': 'ğŸŒ ç½‘ç»œé”™è¯¯ï¼Œè¯­éŸ³è¯†åˆ«éœ€è¦ç¨³å®šç½‘ç»œ',
          'audio-capture': 'âŒ æœªæ‰¾åˆ°éº¦å…‹é£è®¾å¤‡'
        };
        resultEl.textContent = errorMsg[error.error] || `âŒ è¯†åˆ«é”™è¯¯ï¼š${error.error}`;
      };

      // è¯†åˆ«ç»“æŸåè‡ªåŠ¨é‡å¯ï¼ˆæŒç»­è†å¬ï¼‰
      recognition.onend = () => {
        if (isListening) {
          recognition.start();
        }
      };

      return recognition;
    }

    // å¼€å§‹è†å¬
    function startListening() {
      if (!recognition) recognition = initRecognition();
      if (!recognition || isListening) return;

      isListening = true;
      recognition.start();
      startBtn.disabled = true;
      stopBtn.disabled = false;
      startBtn.style.opacity = 0.5;
      stopBtn.style.opacity = 1;
      resultEl.textContent = 'ğŸ” æ­£åœ¨è†å¬... è¯·è¯´è¯';
    }

    // åœæ­¢è†å¬
    function stopListening() {
      if (!recognition || !isListening) return;

      isListening = false;
      recognition.stop();
      startBtn.disabled = false;
      stopBtn.disabled = true;
      startBtn.style.opacity = 1;
      stopBtn.style.opacity = 0.5;
      resultEl.textContent = `âœ… å·²åœæ­¢è†å¬\n\næœ€åè¯†åˆ«å†…å®¹ï¼š${resultEl.textContent.replace('ğŸ” æ­£åœ¨è†å¬... è¯·è¯´è¯', '').replace('ğŸ¤ ä½ è¯´çš„ï¼š', '')}`;
    }

    // æŒ‰é’®äº‹ä»¶ç»‘å®š
    startBtn.addEventListener('click', startListening);
    stopBtn.addEventListener('click', stopListening);

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.onload = initRecognition;
  </script>
</body>
</html>
