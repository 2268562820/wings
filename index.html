<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>语音识别测试</title>
  <style>
    button { padding: 10px 20px; font-size: 16px; margin: 5px; }
    #result { margin: 20px 0; padding: 10px; border: 1px solid #ccc; min-height: 50px; }
  </style>
</head>
<body>
  <h1>基础语音识别测试</h1>
  <button id="startBtn">开始聆听</button>
  <button id="stopBtn" disabled>停止聆听</button>
  <div id="result">请点击“开始聆听”并说出内容</div>

  <script>
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const resultEl = document.getElementById('result');
    let recognition;
    let isListening = false;

    // 初始化语音识别（兼容Chrome/Edge）
    function initRecognition() {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if (!SpeechRecognition) {
        resultEl.textContent = '您的浏览器不支持语音识别，请使用Chrome或Edge';
        return null;
      }
      recognition = new SpeechRecognition();
      recognition.lang = 'zh-CN'; // 设置为中文
      recognition.interimResults = true; // 实时显示结果
      recognition.continuous = true; // 持续聆听

      // 识别结果回调
      recognition.onresult = (event) => {
        let transcript = '';
        for (let i = event.resultIndex; i < event.results.length; i++) {
          transcript += event.results[i][0].transcript;
        }
        resultEl.textContent = '你说的：' + transcript;
      };

      // 结束后自动重启（如果处于聆听状态）
      recognition.onend = () => {
        if (isListening) recognition.start();
      };

      return recognition;
    }

    // 开始聆听
    function startRecognition() {
      if (!recognition) initRecognition();
      if (recognition && !isListening) {
        isListening = true;
        recognition.start();
        startBtn.disabled = true;
        stopBtn.disabled = false;
        resultEl.textContent = '正在聆听...';
      }
    }

    // 停止聆听
    function stopRecognition() {
      if (recognition && isListening) {
        isListening = false;
        recognition.stop();
        startBtn.disabled = false;
        stopBtn.disabled = true;
        resultEl.textContent = '已停止聆听';
      }
    }

    // 按钮事件
    startBtn.addEventListener('click', startRecognition);
    stopBtn.addEventListener('click', stopRecognition);

    // 初始化
    initRecognition();
  </script>
</body>
</html>
